<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√¥ ph·ªèng Ch√≠nh s√°ch Ti·ªÅn t·ªá N·ªõi l·ªèng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .slider-label { min-width: 180px; }
        .indicator-value { font-weight: bold; }
        .explanation-section h4 { font-size: 1.125rem; margin-top: 0.75rem; margin-bottom: 0.25rem; font-weight: 600; }
        .explanation-section p, .explanation-section ul { margin-bottom: 0.5rem; }
        .explanation-section ul { list-style-position: inside; padding-left: 1rem;}
        .explanation-section li { margin-bottom: 0.25rem;}
        /* Custom styles for better visual appeal */
        .control-panel, .indicator-panel, .scenario-panel, .simulation-controls, .explanation-section, .chart-container, .risk-warning-panel {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            margin-bottom: 1.5rem;
        }
        h2, h3 {
            color: #1e3a8a; /* Dark blue */
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.1s ease;
            cursor: pointer;
        }
        .btn-primary {
            background-color: #2563eb; /* Blue */
            color: white;
        }
        .btn-primary:hover {
            background-color: #1d4ed8;
        }
        .btn-secondary {
            background-color: #64748b; /* Slate */
            color: white;
        }
        .btn-secondary:hover {
            background-color: #475569;
        }
        .btn-warning {
            background-color: #f59e0b; /* Amber */
            color: white;
        }
        .btn-warning:hover {
            background-color: #d97706;
        }
        .btn:active {
            transform: scale(0.98);
        }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #d1d5db; /* Gray-300 */
            outline: none;
            border-radius: 4px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #2563eb; /* Blue-600 */
            cursor: pointer;
            border-radius: 50%;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #2563eb; /* Blue-600 */
            cursor: pointer;
            border-radius: 50%;
            border: none;
        }
        .risk-alert {
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-top: 0.5rem;
            font-weight: 500;
        }
        .risk-alert.high-inflation { background-color: #fef2f2; color: #dc2626; border: 1px solid #fca5a5; } /* Red */
        .risk-alert.high-unemployment { background-color: #fffbeb; color: #d97706; border: 1px solid #fde68a; } /* Amber */
        .risk-alert.low-gdp { background-color: #eff6ff; color: #3b82f6; border: 1px solid #93c5fd; } /* Blue */
        .risk-alert.high-credit { background-color: #f0fdf4; color: #16a34a; border: 1px solid #86efac; } /* Green */
        
        /* Added style for chart container height */
        .chart-container {
            position: relative; /* Needed for Chart.js responsiveness */
            height: 60vh; /* Adjust this value as needed, e.g., 400px, 50vh */
            max-height: 500px; /* Optional: set a max pixel height */
        }
        #indicatorChart {
            width: 100% !important;
            height: 100% !important;
        }

    </style>
</head>
<body class="bg-slate-100 p-4 md:p-8">
    <div class="container mx-auto max-w-6xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-blue-700">M√¥ ph·ªèng Ch√≠nh s√°ch Ti·ªÅn t·ªá N·ªõi l·ªèng</h1>
            <p class="text-slate-600 mt-2">Th·ª≠ nghi·ªám c√°c c√¥ng c·ª• ch√≠nh s√°ch v√† quan s√°t t√°c ƒë·ªông l√™n n·ªÅn kinh t·∫ø.</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div class="md:col-span-1 control-panel">
                <h2 class="text-2xl font-semibold mb-4">üéõÔ∏è C√¥ng c·ª• ƒêi·ªÅu khi·ªÉn</h2>
                <div class="space-y-5">
                    <div>
                        <label for="policyRate" class="block text-sm font-medium text-slate-700 slider-label">L√£i su·∫•t ch√≠nh s√°ch (%):</label>
                        <div class="flex items-center space-x-2">
                            <input type="range" id="policyRate" name="policyRate" min="0.5" max="10" step="0.1" value="5" class="w-full">
                            <span id="policyRateValue" class="text-sm font-semibold text-blue-600 w-12 text-right">5.0%</span>
                        </div>
                    </div>
                    <div>
                        <label for="reserveRequirement" class="block text-sm font-medium text-slate-700 slider-label">T·ª∑ l·ªá d·ª± tr·ªØ b·∫Øt bu·ªôc (%):</label>
                         <div class="flex items-center space-x-2">
                            <input type="range" id="reserveRequirement" name="reserveRequirement" min="1" max="8" step="0.1" value="5" class="w-full">
                            <span id="reserveRequirementValue" class="text-sm font-semibold text-blue-600 w-12 text-right">5.0%</span>
                        </div>
                    </div>
                    <div>
                        <label for="omoAmount" class="block text-sm font-medium text-slate-700 slider-label">Nghi·ªáp v·ª• OMO (mua, t·ª∑ VNƒê):</label>
                        <div class="flex items-center space-x-2">
                            <input type="range" id="omoAmount" name="omoAmount" min="50" max="500" step="10" value="100" class="w-full">
                            <span id="omoAmountValue" class="text-sm font-semibold text-blue-600 w-16 text-right">100</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="md:col-span-2 indicator-panel">
                <h2 class="text-2xl font-semibold mb-4">üìä Ch·ªâ s·ªë Theo d√µi</h2>
                <div class="grid grid-cols-2 sm:grid-cols-2 gap-4">
                    <div class="bg-blue-50 p-4 rounded-lg shadow">
                        <p class="text-sm text-blue-700">TƒÉng tr∆∞·ªüng GDP (%):</p>
                        <p id="gdpGrowth" class="text-2xl indicator-value text-blue-600">3.0</p>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg shadow">
                        <p class="text-sm text-red-700">L·∫°m ph√°t (%):</p>
                        <p id="inflation" class="text-2xl indicator-value text-red-600">2.0</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg shadow">
                        <p class="text-sm text-yellow-700">T·ª∑ l·ªá th·∫•t nghi·ªáp (%):</p>
                        <p id="unemployment" class="text-2xl indicator-value text-yellow-600">5.0</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg shadow">
                        <p class="text-sm text-green-700">TƒÉng tr∆∞·ªüng t√≠n d·ª•ng (%):</p>
                        <p id="creditGrowth" class="text-2xl indicator-value text-green-600">10.0</p>
                    </div>
                </div>
                <div id="riskWarningPanel" class="mt-4 risk-warning-panel p-0 bg-transparent shadow-none">
                    <h3 class="text-lg font-semibold mb-2 text-slate-700">‚ö†Ô∏è C·∫£nh b√°o R·ªßi ro</h3>
                    <div id="riskWarnings" class="space-y-2">
                        <p class="text-sm text-slate-500">Hi·ªán ch∆∞a c√≥ c·∫£nh b√°o n√†o.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="scenario-panel">
            <h2 class="text-2xl font-semibold mb-4">üéØ C√°c K·ªãch b·∫£n M·∫´u</h2>
            <div class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-3">
                <button id="crisisScenario" class="btn btn-warning">üö® Kh·ªßng ho·∫£ng</button>
                <button id="moderateEasingScenario" class="btn btn-primary">‚ö†Ô∏è N·ªõi l·ªèng v·ª´a ph·∫£i</button>
                <button id="neutralScenario" class="btn btn-secondary">üìä B√¨nh th∆∞·ªùng</button>
                <button id="tighteningScenario" class="btn btn-primary" style="background-color: #7c3aed;">üîí Th·∫Øt ch·∫∑t</button> </div>
        </div>

        <div class="simulation-controls text-center">
            <button id="runSimulation" class="btn btn-primary mr-2">üöÄ Ch·∫°y M√¥ ph·ªèng (24 th√°ng)</button>
            <button id="resetSimulation" class="btn btn-secondary">üîÑ ƒê·∫∑t l·∫°i</button>
        </div>

        <div class="chart-container">
            <h2 class="text-2xl font-semibold mb-4 text-center">üìà Bi·ªÉu ƒë·ªì Xu h∆∞·ªõng Theo Th·ªùi gian</h2>
            <canvas id="indicatorChart"></canvas>
        </div>
        
        <div class="explanation-section">
            <h2 class="text-2xl font-semibold mb-4">üí° Gi·∫£i th√≠ch C∆° ch·∫ø v√† L∆∞u √Ω</h2>
            <div>
                <h4>M·ª•c ti√™u c·ªßa Ch√≠nh s√°ch Ti·ªÅn t·ªá N·ªõi l·ªèng:</h4>
                <p>Ch√≠nh s√°ch ti·ªÅn t·ªá n·ªõi l·ªèng th∆∞·ªùng ƒë∆∞·ª£c √°p d·ª•ng khi n·ªÅn kinh t·∫ø c√≥ d·∫•u hi·ªáu suy gi·∫£m, tƒÉng tr∆∞·ªüng th·∫•p ho·∫∑c t·ª∑ l·ªá th·∫•t nghi·ªáp cao. M·ª•c ti√™u ch√≠nh l√†:</p>
                <ul>
                    <li>K√≠ch th√≠ch tƒÉng tr∆∞·ªüng kinh t·∫ø (GDP).</li>
                    <li>Gi·∫£m t·ª∑ l·ªá th·∫•t nghi·ªáp.</li>
                    <li>TƒÉng c∆∞·ªùng ƒë·∫ßu t∆∞ v√† ti√™u d√πng.</li>
                </ul>

                <h4>C√°c C√¥ng c·ª• Ch√≠nh s√°ch:</h4>
                <ul>
                    <li><strong>L√£i su·∫•t ch√≠nh s√°ch (L√£i su·∫•t ƒëi·ªÅu h√†nh):</strong> Khi NHTW gi·∫£m l√£i su·∫•t n√†y, chi ph√≠ vay v·ªën c·ªßa c√°c ng√¢n h√†ng th∆∞∆°ng m·∫°i (NHTM) gi·∫£m xu·ªëng, t·ª´ ƒë√≥ NHTM c√≥ th·ªÉ gi·∫£m l√£i su·∫•t cho vay ra th·ªã tr∆∞·ªùng, khuy·∫øn kh√≠ch doanh nghi·ªáp v√† ng∆∞·ªùi d√¢n vay v·ªën.</li>
                    <li><strong>T·ª∑ l·ªá d·ª± tr·ªØ b·∫Øt bu·ªôc:</strong> L√† t·ª∑ l·ªá l∆∞·ª£ng ti·ªÅn m√† c√°c NHTM ph·∫£i gi·ªØ l·∫°i t·∫°i NHTW, kh√¥ng ƒë∆∞·ª£c d√πng ƒë·ªÉ cho vay. Khi NHTW gi·∫£m t·ª∑ l·ªá n√†y, c√°c NHTM c√≥ nhi·ªÅu v·ªën kh·∫£ d·ª•ng h∆°n ƒë·ªÉ cho vay, l√†m tƒÉng cung ti·ªÅn.</li>
                    <li><strong>Nghi·ªáp v·ª• th·ªã tr∆∞·ªùng m·ªü (OMO):</strong> Ph·ªï bi·∫øn nh·∫•t l√† NHTW mua v√†o c√°c gi·∫•y t·ªù c√≥ gi√° (nh∆∞ tr√°i phi·∫øu ch√≠nh ph·ªß) t·ª´ c√°c NHTM. H√†nh ƒë·ªông n√†y b∆°m m·ªôt l∆∞·ª£ng ti·ªÅn v√†o h·ªá th·ªëng ng√¢n h√†ng, tƒÉng thanh kho·∫£n v√† c√≥ th·ªÉ l√†m gi·∫£m l√£i su·∫•t tr√™n th·ªã tr∆∞·ªùng li√™n ng√¢n h√†ng.</li>
                </ul>

                <h4>C∆° ch·∫ø Truy·ªÅn d·∫´n (Minh h·ªça ƒë∆°n gi·∫£n):</h4>
                <p><strong>NHTW th·ª±c hi·ªán n·ªõi l·ªèng</strong> (gi·∫£m l√£i su·∫•t, gi·∫£m DTBB, mua OMO) ‚ûî <strong>T√°c ƒë·ªông l√™n NHTM</strong> (chi ph√≠ v·ªën gi·∫£m, v·ªën kh·∫£ d·ª•ng tƒÉng, thanh kho·∫£n d·ªìi d√†o) ‚ûî <strong>NHTM ƒëi·ªÅu ch·ªânh</strong> (gi·∫£m l√£i su·∫•t cho vay, tƒÉng c∆∞·ªùng cho vay) ‚ûî <strong>T√°c ƒë·ªông ƒë·∫øn N·ªÅn kinh t·∫ø</strong> (doanh nghi·ªáp v√† h·ªô gia ƒë√¨nh tƒÉng vay ƒë·ªÉ ƒë·∫ßu t∆∞, s·∫£n xu·∫•t, ti√™u d√πng) ‚ûî <strong>K·∫øt qu·∫£ k·ª≥ v·ªçng</strong> (tƒÉng tr∆∞·ªüng GDP cao h∆°n, t·ª∑ l·ªá th·∫•t nghi·ªáp gi·∫£m, t√≠n d·ª•ng tƒÉng tr∆∞·ªüng).</p>
                <p class="italic text-sm">S∆° ƒë·ªì: NHTW ‚Üí C√¥ng c·ª• ch√≠nh s√°ch ‚Üí Ng√¢n h√†ng Th∆∞∆°ng m·∫°i ‚Üí Chi ph√≠ v·ªën & Kh·∫£ nƒÉng cho vay ‚Üí Doanh nghi·ªáp & H·ªô gia ƒë√¨nh ‚Üí ƒê·∫ßu t∆∞ & Ti√™u d√πng ‚Üí GDP, L·∫°m ph√°t, Th·∫•t nghi·ªáp.</p>


                <h4>R·ªßi ro v√† L∆∞u √Ω Quan tr·ªçng:</h4>
                <ul>
                    <li><strong>R·ªßi ro l·∫°m ph√°t:</strong> N·ªõi l·ªèng qu√° m·ª©c ho·∫∑c k√©o d√†i c√≥ th·ªÉ l√†m tƒÉng t·ªïng c·∫ßu qu√° nhanh, g√¢y √°p l·ª±c l√™n gi√° c·∫£ v√† d·∫´n ƒë·∫øn l·∫°m ph√°t cao.</li>
                    <li><strong>Bong b√≥ng t√†i s·∫£n:</strong> L∆∞·ª£ng ti·ªÅn l·ªõn v√† l√£i su·∫•t th·∫•p c√≥ th·ªÉ ch·∫£y v√†o c√°c th·ªã tr∆∞·ªùng t√†i s·∫£n (b·∫•t ƒë·ªông s·∫£n, ch·ª©ng kho√°n), t·∫°o ra nguy c∆° bong b√≥ng.</li>
                    <li><strong>ƒê·ªô tr·ªÖ c·ªßa ch√≠nh s√°ch:</strong> T√°c ƒë·ªông c·ªßa ch√≠nh s√°ch ti·ªÅn t·ªá th∆∞·ªùng c√≥ ƒë·ªô tr·ªÖ nh·∫•t ƒë·ªãnh m·ªõi ph·∫£n √°nh ƒë·∫ßy ƒë·ªß v√†o n·ªÅn kinh t·∫ø (c√≥ th·ªÉ t·ª´ v√†i th√°ng ƒë·∫øn h∆°n m·ªôt nƒÉm).</li>
                    <li><strong>C√°c y·∫øu t·ªë kh√°c:</strong> Hi·ªáu qu·∫£ c·ªßa ch√≠nh s√°ch c√≤n ph·ª• thu·ªôc v√†o nhi·ªÅu y·∫øu t·ªë kh√°c nh∆∞ ni·ªÅm tin c·ªßa th·ªã tr∆∞·ªùng, s·ª©c kh·ªèe h·ªá th·ªëng t√†i ch√≠nh, ch√≠nh s√°ch t√†i kh√≥a v√† c√°c ƒëi·ªÅu ki·ªán kinh t·∫ø to√†n c·∫ßu.</li>
                </ul>
                 <p class="mt-4 text-sm text-slate-500"><em>M√¥ ph·ªèng n√†y s·ª≠ d·ª•ng c√°c m√¥ h√¨nh ƒë∆°n gi·∫£n h√≥a ƒë·ªÉ minh h·ªça. K·∫øt qu·∫£ th·ª±c t·∫ø c√≥ th·ªÉ ph·ª©c t·∫°p h∆°n nhi·ªÅu.</em></p>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const policyRateSlider = document.getElementById('policyRate');
        const policyRateValueDisplay = document.getElementById('policyRateValue');
        const reserveRequirementSlider = document.getElementById('reserveRequirement');
        const reserveRequirementValueDisplay = document.getElementById('reserveRequirementValue');
        const omoAmountSlider = document.getElementById('omoAmount');
        const omoAmountValueDisplay = document.getElementById('omoAmountValue');

        const gdpGrowthDisplay = document.getElementById('gdpGrowth');
        const inflationDisplay = document.getElementById('inflation');
        const unemploymentDisplay = document.getElementById('unemployment');
        const creditGrowthDisplay = document.getElementById('creditGrowth');

        const riskWarningsContainer = document.getElementById('riskWarnings');

        const crisisScenarioBtn = document.getElementById('crisisScenario');
        const moderateEasingScenarioBtn = document.getElementById('moderateEasingScenario');
        const neutralScenarioBtn = document.getElementById('neutralScenario');
        const tighteningScenarioBtn = document.getElementById('tighteningScenario');

        const runSimulationBtn = document.getElementById('runSimulation');
        const resetSimulationBtn = document.getElementById('resetSimulation');
        const chartCanvas = document.getElementById('indicatorChart');

        // Initial State
        let config = {
            policyRate: 5.0,
            reserveRequirement: 5.0,
            omoAmount: 100, // t·ª∑ VND
        };

        let indicators = {
            gdpGrowth: 3.0,
            inflation: 2.0,
            unemployment: 5.0,
            creditGrowth: 10.0,
        };
        
        const BASE_VALUES = { // Baseline economic conditions for reset and reference
            gdpGrowth: 3.0,
            inflation: 2.0,
            unemployment: 5.0,
            creditGrowth: 10.0,
            policyRate: 5.0,
            reserveRequirement: 5.0,
            omoAmount: 100,
        };

        let historicalData = {
            time: [],
            gdpGrowth: [],
            inflation: [],
            unemployment: [],
            creditGrowth: [],
        };
        let simulationTimeStep = 0;
        let chartInstance;
        let simulationInterval;

        const SIMULATION_PERIODS = 24; // months
        const ADJUSTMENT_FACTOR = 0.35; // How quickly indicators react in one step (0 to 1)

        // --- Core Logic Functions ---

        function updateDisplays() {
            policyRateValueDisplay.textContent = `${parseFloat(config.policyRate).toFixed(1)}%`;
            policyRateSlider.value = config.policyRate;

            reserveRequirementValueDisplay.textContent = `${parseFloat(config.reserveRequirement).toFixed(1)}%`;
            reserveRequirementSlider.value = config.reserveRequirement;

            omoAmountValueDisplay.textContent = `${config.omoAmount}`;
            omoAmountSlider.value = config.omoAmount;

            gdpGrowthDisplay.textContent = parseFloat(indicators.gdpGrowth).toFixed(1);
            inflationDisplay.textContent = parseFloat(indicators.inflation).toFixed(1);
            unemploymentDisplay.textContent = parseFloat(indicators.unemployment).toFixed(1);
            creditGrowthDisplay.textContent = parseFloat(indicators.creditGrowth).toFixed(1);
            checkRiskWarnings();
        }
        
        // Simplified model for policy impact
        function calculateTargetIndicators() {
            // Normalize policy inputs (deviation from a neutral/base setting)
            // Higher values for rate/RR are tightening, lower are easing. Higher OMO is easing.
            const rateEffect = (BASE_VALUES.policyRate - config.policyRate) * 0.25; // e.g., 1% rate cut = +0.25 stimulus points
            const rrEffect = (BASE_VALUES.reserveRequirement - config.reserveRequirement) * 0.4; // e.g., 1% RR cut = +0.4 stimulus points
            const omoEffect = (config.omoAmount - BASE_VALUES.omoAmount) / 100 * 0.3; // e.g., 100 t·ª∑ OMO increase = +0.3 stimulus points
            
            const monetaryStimulus = rateEffect + rrEffect + omoEffect;

            // Target Credit Growth: Stimulus directly boosts credit
            let targetCreditGrowth = BASE_VALUES.creditGrowth + monetaryStimulus * 3.0;
            targetCreditGrowth = Math.max(0, Math.min(targetCreditGrowth, 30)); // Cap credit growth

            // Target GDP: Stimulus and credit growth boost GDP, inflation slightly dampens it
            let targetGDPGrowth = BASE_VALUES.gdpGrowth + monetaryStimulus * 0.8 + (indicators.creditGrowth - BASE_VALUES.creditGrowth) * 0.15 - (indicators.inflation - BASE_VALUES.inflation) * 0.05;
            targetGDPGrowth = Math.max(-5, Math.min(targetGDPGrowth, 12));

            // Target Inflation: Stimulus, high GDP, and high credit growth can fuel inflation
            let targetInflation = BASE_VALUES.inflation + monetaryStimulus * 0.6 + (indicators.gdpGrowth - BASE_VALUES.gdpGrowth) * 0.1 + (indicators.creditGrowth - BASE_VALUES.creditGrowth) * 0.08;
            targetInflation = Math.max(0, Math.min(targetInflation, 15));

            // Target Unemployment: High GDP growth reduces unemployment, high inflation might slightly worsen it if it chokes growth
            let targetUnemployment = BASE_VALUES.unemployment - (indicators.gdpGrowth - BASE_VALUES.gdpGrowth) * 0.7;
            targetUnemployment = Math.max(1, Math.min(targetUnemployment, 20));
            
            return { targetGDPGrowth, targetInflation, targetUnemployment, targetCreditGrowth };
        }

        function applyPolicyChange() {
            const targets = calculateTargetIndicators();

            indicators.creditGrowth += (targets.targetCreditGrowth - indicators.creditGrowth) * ADJUSTMENT_FACTOR;
            indicators.gdpGrowth += (targets.targetGDPGrowth - indicators.gdpGrowth) * ADJUSTMENT_FACTOR;
            indicators.inflation += (targets.targetInflation - indicators.inflation) * ADJUSTMENT_FACTOR;
            indicators.unemployment += (targets.targetUnemployment - indicators.unemployment) * ADJUSTMENT_FACTOR;
            
            // Ensure indicators stay within reasonable bounds after immediate adjustment
            indicators.creditGrowth = Math.max(0, Math.min(indicators.creditGrowth, 30));
            indicators.gdpGrowth = Math.max(-5, Math.min(indicators.gdpGrowth, 12));
            indicators.inflation = Math.max(0, Math.min(indicators.inflation, 15));
            indicators.unemployment = Math.max(1, Math.min(indicators.unemployment, 20));

            updateDisplays();
        }

        function recordHistoricalData() {
            simulationTimeStep++;
            historicalData.time.push(simulationTimeStep);
            historicalData.gdpGrowth.push(parseFloat(indicators.gdpGrowth.toFixed(1)));
            historicalData.inflation.push(parseFloat(indicators.inflation.toFixed(1)));
            historicalData.unemployment.push(parseFloat(indicators.unemployment.toFixed(1)));
            historicalData.creditGrowth.push(parseFloat(indicators.creditGrowth.toFixed(1)));
        }

        function updateChart() {
            if (chartInstance) {
                chartInstance.data.labels = historicalData.time;
                chartInstance.data.datasets[0].data = historicalData.gdpGrowth;
                chartInstance.data.datasets[1].data = historicalData.inflation;
                chartInstance.data.datasets[2].data = historicalData.unemployment;
                chartInstance.data.datasets[3].data = historicalData.creditGrowth;
                chartInstance.update();
            }
        }
        
        function runSingleSimulationStep() {
            applyPolicyChange(); // This applies the effect of current settings
            recordHistoricalData();
            updateChart();
            checkRiskWarnings();
        }

        function startSimulation() {
            if (simulationInterval) clearInterval(simulationInterval); // Clear any existing interval
            
            // Reset history for a new simulation run, but keep current indicator values as starting point
            historicalData = { time: [], gdpGrowth: [], inflation: [], unemployment: [], creditGrowth: [] };
            simulationTimeStep = 0;
            recordHistoricalData(); // Record initial state for the chart
            updateChart();

            let currentPeriod = 0;
            setControlsEnabled(false);

            simulationInterval = setInterval(() => {
                currentPeriod++;
                runSingleSimulationStep();
                if (currentPeriod >= SIMULATION_PERIODS) {
                    clearInterval(simulationInterval);
                    simulationInterval = null;
                    setControlsEnabled(true);
                    console.log("Simulation finished.");
                }
            }, 700); // Run step every 700ms
        }
        
        function setControlsEnabled(enabled) {
            policyRateSlider.disabled = !enabled;
            reserveRequirementSlider.disabled = !enabled;
            omoAmountSlider.disabled = !enabled;
            runSimulationBtn.disabled = !enabled;
            // Keep reset and scenario buttons always enabled for now, or manage their state too
            crisisScenarioBtn.disabled = !enabled;
            moderateEasingScenarioBtn.disabled = !enabled;
            neutralScenarioBtn.disabled = !enabled;
            tighteningScenarioBtn.disabled = !enabled;

            runSimulationBtn.classList.toggle('opacity-50', !enabled);
            runSimulationBtn.classList.toggle('cursor-not-allowed', !enabled);
        }


        function resetAll() {
            if (simulationInterval) clearInterval(simulationInterval);
            simulationInterval = null;
            setControlsEnabled(true);

            config.policyRate = BASE_VALUES.policyRate;
            config.reserveRequirement = BASE_VALUES.reserveRequirement;
            config.omoAmount = BASE_VALUES.omoAmount;

            indicators.gdpGrowth = BASE_VALUES.gdpGrowth;
            indicators.inflation = BASE_VALUES.inflation;
            indicators.unemployment = BASE_VALUES.unemployment;
            indicators.creditGrowth = BASE_VALUES.creditGrowth;
            
            historicalData = { time: [], gdpGrowth: [], inflation: [], unemployment: [], creditGrowth: [] };
            simulationTimeStep = 0;
            
            updateDisplays();
            recordHistoricalData(); // Record initial state for chart
            updateChart(); // Clear chart or show initial state
        }

        function applyPreset(presetConfig) {
            if (simulationInterval) clearInterval(simulationInterval); // Stop running simulation if any
            setControlsEnabled(true);

            config.policyRate = presetConfig.policyRate;
            config.reserveRequirement = presetConfig.reserveRequirement;
            config.omoAmount = presetConfig.omoAmount;
            
            // When applying a preset, we can either reset indicators to base OR
            // let the new policy affect current indicators. For simplicity and immediate feedback,
            // let's reset indicators to base, then apply one step of the new policy.
            indicators.gdpGrowth = BASE_VALUES.gdpGrowth;
            indicators.inflation = BASE_VALUES.inflation;
            indicators.unemployment = BASE_VALUES.unemployment;
            indicators.creditGrowth = BASE_VALUES.creditGrowth;
            
            applyPolicyChange(); // Apply one immediate step based on new preset
            
            // Reset history for chart
            historicalData = { time: [], gdpGrowth: [], inflation: [], unemployment: [], creditGrowth: [] };
            simulationTimeStep = 0;
            recordHistoricalData(); // Record this new state
            updateDisplays();
            updateChart();
        }

        function checkRiskWarnings() {
            riskWarningsContainer.innerHTML = ''; // Clear previous warnings
            let hasWarnings = false;

            if (indicators.inflation > 6) {
                const warning = document.createElement('p');
                warning.className = 'risk-alert high-inflation';
                warning.textContent = `L·∫°m ph√°t cao (${indicators.inflation.toFixed(1)}%)! Nguy c∆° b·∫•t ·ªïn kinh t·∫ø.`;
                riskWarningsContainer.appendChild(warning);
                hasWarnings = true;
            }
             if (indicators.inflation > 4 && indicators.inflation <= 6) {
                const warning = document.createElement('p');
                warning.className = 'risk-alert high-inflation';
                warning.textContent = `L·∫°m ph√°t c√≥ xu h∆∞·ªõng tƒÉng (${indicators.inflation.toFixed(1)}%). C·∫ßn theo d√µi.`;
                riskWarningsContainer.appendChild(warning);
                hasWarnings = true;
            }
            if (indicators.unemployment > 7) {
                const warning = document.createElement('p');
                warning.className = 'risk-alert high-unemployment';
                warning.textContent = `T·ª∑ l·ªá th·∫•t nghi·ªáp cao (${indicators.unemployment.toFixed(1)}%)! C·∫ßn c√°c bi·ªán ph√°p h·ªó tr·ª£.`;
                riskWarningsContainer.appendChild(warning);
                hasWarnings = true;
            }
            if (indicators.gdpGrowth < 1) {
                const warning = document.createElement('p');
                warning.className = 'risk-alert low-gdp';
                warning.textContent = `TƒÉng tr∆∞·ªüng GDP th·∫•p (${indicators.gdpGrowth.toFixed(1)}%)! Nguy c∆° suy gi·∫£m.`;
                riskWarningsContainer.appendChild(warning);
                hasWarnings = true;
            }
            if (indicators.creditGrowth > 20) {
                const warning = document.createElement('p');
                warning.className = 'risk-alert high-credit';
                warning.textContent = `TƒÉng tr∆∞·ªüng t√≠n d·ª•ng cao (${indicators.creditGrowth.toFixed(1)}%)! R·ªßi ro bong b√≥ng t√†i s·∫£n.`;
                riskWarningsContainer.appendChild(warning);
                hasWarnings = true;
            }

            if (!hasWarnings) {
                const noWarning = document.createElement('p');
                noWarning.className = 'text-sm text-slate-500';
                noWarning.textContent = 'Hi·ªán ch∆∞a c√≥ c·∫£nh b√°o n√†o ƒë√°ng k·ªÉ.';
                riskWarningsContainer.appendChild(noWarning);
            }
        }

        // --- Event Listeners ---
        policyRateSlider.addEventListener('input', (e) => {
            config.policyRate = parseFloat(e.target.value);
            updateDisplays(); // Update display immediately
        });
        policyRateSlider.addEventListener('change', () => { // Apply effect on release
            applyPolicyChange();
            recordHistoricalData(); 
            updateChart();
        });

        reserveRequirementSlider.addEventListener('input', (e) => {
            config.reserveRequirement = parseFloat(e.target.value);
            updateDisplays();
        });
         reserveRequirementSlider.addEventListener('change', () => {
            applyPolicyChange();
            recordHistoricalData();
            updateChart();
        });

        omoAmountSlider.addEventListener('input', (e) => {
            config.omoAmount = parseInt(e.target.value);
            updateDisplays();
        });
        omoAmountSlider.addEventListener('change', () => {
            applyPolicyChange();
            recordHistoricalData();
            updateChart();
        });

        runSimulationBtn.addEventListener('click', startSimulation);
        resetSimulationBtn.addEventListener('click', resetAll);

        crisisScenarioBtn.addEventListener('click', () => applyPreset({ policyRate: 1.0, reserveRequirement: 2.0, omoAmount: 300 }));
        moderateEasingScenarioBtn.addEventListener('click', () => applyPreset({ policyRate: 3.0, reserveRequirement: 4.0, omoAmount: 200 }));
        neutralScenarioBtn.addEventListener('click', () => applyPreset({ policyRate: 5.0, reserveRequirement: 6.0, omoAmount: 100 }));
        tighteningScenarioBtn.addEventListener('click', () => applyPreset({ policyRate: 8.0, reserveRequirement: 8.0, omoAmount: 50 })); // OMO 50 means less stimulus

        // --- Chart Initialization ---
        function initChart() {
            const ctx = chartCanvas.getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: historicalData.time,
                    datasets: [
                        {
                            label: 'TƒÉng tr∆∞·ªüng GDP (%)',
                            data: historicalData.gdpGrowth,
                            borderColor: 'rgb(59, 130, 246)', // blue-500
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.1,
                            fill: true,
                        },
                        {
                            label: 'L·∫°m ph√°t (%)',
                            data: historicalData.inflation,
                            borderColor: 'rgb(239, 68, 68)', // red-500
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.1,
                            fill: true,
                        },
                        {
                            label: 'T·ª∑ l·ªá th·∫•t nghi·ªáp (%)',
                            data: historicalData.unemployment,
                            borderColor: 'rgb(245, 158, 11)', // amber-500
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.1,
                            fill: true,
                        },
                        {
                            label: 'TƒÉng tr∆∞·ªüng t√≠n d·ª•ng (%)',
                            data: historicalData.creditGrowth,
                            borderColor: 'rgb(34, 197, 94)', // green-500
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            tension: 0.1,
                            fill: true,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // Crucial for custom height
                    scales: {
                        y: {
                            beginAtZero: false, // Allow negative GDP growth
                            title: { display: true, text: 'Gi√° tr·ªã (%)' }
                        },
                        x: {
                            title: { display: true, text: 'Th·ªùi gian (Th√°ng m√¥ ph·ªèng)'}
                        }
                    },
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: { mode: 'index', intersect: false }
                    },
                    animation: {
                        duration: 300 // smoother animation
                    }
                }
            });
        }

        // --- Initialization ---
        window.onload = () => {
            updateDisplays();
            initChart();
            recordHistoricalData(); // Record initial state for chart
            updateChart(); // Display initial chart
            checkRiskWarnings(); // Initial check
        };
    </script>
</body>
</html>
